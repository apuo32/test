<div class="card mb-5">
  <h5 class="card-header">新規作成</h5>
  <div class="card-body">

    <% if @errors.present? %>
      <div class="alert alert-danger">
        <% @errors.each do |error| %>
          <p><%= error %></p>
        <% end %>
      </div>
    <% end %>

    <%= form_with(model: @kaizen_report, local: true) do |form| %>
      <div class="form-group">
        <p>社員CD: <%= current_user.employee_code %></p>
        <p>部署: <%= current_user.department.department_name %></p>
        <p>氏名: <%= current_user.username %></p>

        <p>
          <%= form.label :submission_date, "提出日:" %>
          <%= form.select :submission_date, @evaluation_dates, { prompt: "選択してください" }, { disabled: @kaizen_report.evaluator_progress_id == 5 } %>
        </p>

        <p>
          <%= form.label :subject, "件名:" %>
          <%= form.text_field :subject %>
        </p>

        <p>
          <%= form.label :before_images, "改善前の画像:" %>
          <%= form.file_field :before_images, multiple: true, id: "before-images-upload" %>
        </p>

        <div id="images-preview"></div>

        <p>
          <%= form.label :before_text, "改善前のテキスト:" %>
          <%= form.text_area :before_text %>
        </p>

        <p>
          <%= form.label :after_images, "改善後の画像:" %>
          <%= form.file_field :after_images, multiple: true, id: "after-images-upload" %>
        </p>

        <div id="after-images-preview"></div>

        <p>
          <%= form.label :after_text, "改善後のテキスト:" %>
          <%= form.text_area :after_text %>
        </p>

        <p>
          <%= form.label :effect_comment, "効果コメント:" %>
          <%= form.text_area :effect_comment %>
        </p>

        <p>
          <%= form.label :cost, "費用:" %>
          <%= form.number_field :cost, step: "any", class: "form-control" %>
          <span>円</span>
        </p>

        <p>
          <%= form.label :effect_amount, "効果金額:" %>
          <%= form.number_field :effect_amount, step: "any", class: "form-control" %>
          <span>円</span>
        </p>

        <p>
          <%= form.label :tsk_value_id, "TSKバリュー:" %>
          <%= form.collection_select :tsk_value_id, @tsk_values, :id, :value_name, prompt: "選択してください" %>
        </p>

        <p>
          <%= form.label :kaizen_member_id, "KAIZENメンバー:" %>
          <select name="kaizen_report[kaizen_member_id][]" id="select-kaizen-member" multiple="multiple" autocomplete="off">
            <% @users.each do |user| %>
              <% selected = @kaizen_report.kaizen_member_id.include?(user.id.to_s) ? 'selected' : nil %>
              <option value="<%= user.id %>" <%= selected %>><%= user.username %></option>
            <% end %>
          </select>
        </p>

        <p>
          <!-- 評価進捗区分：初期値に"未評価"を設定 -->
          <% if @kaizen_report.evaluator_progress_id == 1 %>
            <%= form.hidden_field :evaluator_progress_id, value: 1 %>
          <% end %>
        </p>

        <p>
          <!-- 賞区分：初期値に"賞無し"を設定 -->
          <%= form.hidden_field :award_id, value: 4 %>
        </p>

        <p>
          <%= form.submit "提出", name: "submit", class: "btn btn-sm btn-primary", data: { turbo_method: :post, turbo_confirm: "本当に提出しますか?" } %>
          <%= form.submit "保存", name: "save", class: "btn btn-sm btn-secondary" %>
          <%= link_to '戻る', user_path(current_user), class: 'btn btn-sm btn-danger', data: { turbo_method: :get, turbo_confirm: '保存されていませんがよろしいですか？' } %>
        </p>
      </div>
    <% end %>
  </div>
</div>